
Changes
========

****************************
Version 3.0.0-RC1
****************************

Date: July 24, 2020

This version corresponds to the first release candidate of Connectome Mapper 3. In particular, it integrates Pull Request #40 where the last major changes prior to its official release have been made, which includes in particular:

*Migration to Python 3*

* Fixes automatically with ``2to3`` and manually a number of Python 2 statements invalid in python 3 including the print() function

* Correct automatically PEP8 code style issues with autopep8

* Correct a number of code stly issues reported by Codacy (bandits/pylints/flake8)

*Code coverage*

* Use `coveragepy <https://coverage.readthedocs.io/en/coverage-5.2/>`_  in CircleCI during regression tests of the BIDS app and create code coverage reports

*Changes in BIDS derivatives*

* Renamed parcellation files

* Renamed connectivity graph files

*Upgrades*

* Use Dipy 1.0 and related code changes in ``cmtklib/interfaces/dipy`` (Check `here <https://dipy.org/documentation/1.0.0./api_changes/#dipy-1-0-changes>`_ for more details about Dipy 1.0 changes)

* Use Nipype 1.5.0

* Use NetworkX 2.4

*Code refactoring*

* Functions to save and load pipeline configuration files have been moved to ``cmtklib/config.py``

*Bug fixes*

* Major changes in how inspection of stage/pipeline outputs with the graphical user interface (cmpbidsappmanager) which was not working anymore after migration to Python3

* Fixes to compute the structural connectivity matrices following migration to python 3

* Fixes to computes ROI volumetry for Lausanne2008 and NativeFreesurfer parcellation schemes

* Add missing renaming of the ROI volumetry file for the NativeFreesurfer parcellation scheme following BIDS

* Create the mask used for computing peaks from the Dipy CSD model when performing Particle Filtering Tractography (development still on-going)

* Add missing renaming of Dipy tensor-related maps (AD, RD, MD) following BIDS

Please check the `pull request 40 page <https://github.com/connectomicslab/connectomemapper3/pull/40>`_ for more details.


****************************
Version 3.0.0-beta-RC2
****************************

Date: June 02, 2020

This version integrates Pull Request #33 which includes in particular:


*Upgrade*

* Uses  `fsleyes` instead of `fslview` (now deprecated), which now included in the conda environment of the GUI (`py27cmp-gui`).

*New feature*

* Computes of ROI volumetry stored in `<output_dir>/sub-<label>(/ses<label>)/anat` folder, recognized by their `_stats.tsv` file name suffix.

*Improved replicability*

* Sets the `MATRIX_RNG_SEED` environment variable (used by MRtrix) and seed for the numpy random number generator (`numpy.random.seed()`)

*Bug fixes*

* Fixes the output inspector window of the cmpbidsappmanager (GUI) that fails to find existing outputs, after adoption of /bids_dir and /output_dir in the bidsapp docker image.

* Fixes the way to get the list of networkx edge attributes in `inspect_outputs()` of `ConnectomeStage` for the output inspector window of the cmpbidsappmanager (GUI)

* Added missing package dependencies (`fury` and `vtk`) that fixes dipy_CSD execution error when trying to import module actor from dipy.viz to save the results in a png

* Fixes a number of unresolved references identified by pycharm code inspection tool

*Code refactoring*

* Interfaces for fMRI processing were moved to `cmtklib/functionalMRI.py`.

* Interface for fMRI connectome creation (`rsfmri_conmat`)  moved to  `cmtklib/connectome.py`

Please check the `pull request 33 page <https://github.com/connectomicslab/connectomemapper3/pull/33>`_ for change details.


****************************
Version 3.0.0-beta-RC1
****************************

Date: March 26, 2020

This version integrates Pull Request #28 which includes in summary:

* A major revision of continuous integration testing and deployment with CircleCI which closes `Issue 14 <https://github.com/connectomicslab/connectomemapper3/issues/14>`_ integrates an in-house dataset published and available on Zenodo @ https://doi.org/10.5281/zenodo.3708962.

* Multiple bug fixes and enhancements incl. close `Issue 30 <https://github.com/connectomicslab/connectomemapper3/issues/30>`_ , update mrtrix3 to RC3 version, bids-app run command generated by the GUI, location of the configuration and log files to be more BIDS compliant.

* Change in tagging beta version which otherwise might not be meaningfull in accordance with the release date (especially when the expected date is delayed due to unexpected errors that might take longer to be fixed than expected).

Please check the `pull request 28 page <https://github.com/connectomicslab/connectomemapper3/pull/28>`_ for a full list of changes.


****************************
Version 3.0.0-beta-20200227
****************************

Date: February 27, 2020

This version addresses multiple issues to make successful conversion and run of the CMP3 BIDS App on HPC (Clusters) using Singularity.

* Revised the build of the master and BIDS App images:

	* Install locales and set `$LC_ALL` and `$LANG` to make freesurfer hippocampal subfields and brainstem segmentation (matlab-based) modules working when run in the converted SIngularity image

  	* BIDS input and output directories inside the BIDS App container are no longer the `/tmp` and `/tmp/derivatives` folders but `/bids_dir` and `/output_dir`.
  	  .. warning:: this might affect the use of Datalad container (To be confirmed.)

  	* Fix the branch of mrtrix3 to check out

  	* Updated metadata

* Fix the configuration of CircleCI to not use Docker layer cache feature anymore as this feature is not included anymore in the free plan for open source projects.

* Improved documentation where the latest version should be dynamically generated everywhere it should appear.


****************************
Version 3.0.0-beta-20200206
****************************

Date: February 06, 2020

* Implementation of an in-house Nipype interface to AFNI 3DBandPass which can handle to check output as ..++orig.BRIK or as ..tlrc.BRIK (The later can occur with HCP preprocessed fmri data)


****************************
Version 3.0.0-beta-20200124
****************************

Date: January 24, 2020

* Updated multi-scale parcellation with a new symmetric version:

	1. The right hemisphere labels were projected in the left hemisphere to create a symmetric version of the multiscale cortical parcellation proposed by Cammoun2012_.
	2. For scale 1, the boundaries of the projected regions over the left hemisphere were matched to the boundaries of the original parcellation for the left hemisphere.
	3. This transformation was applied for the rest of the scales.

	.. _Cammoun2012: https://doi.org/10.1016/j.jneumeth.2011.09.031

* Updated documentation with list of changes
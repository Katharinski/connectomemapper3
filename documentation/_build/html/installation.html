<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation Instruction &mdash; The Connectome Mapper</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0.2alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="The Connectome Mapper" href="index.html" />
    <link rel="next" title="Download Instruction" href="download.html" />
    <link rel="prev" title="Connectome Mapper" href="index.html" /> 

 <script type="text/javascript" src="_static/jquery.js"></script>
 <script type="text/javascript">
       // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
  </script>      

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="download.html" title="Download Instruction"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="index.html" title="Connectome Mapper"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">The Connectome Mapper</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><i>Latest release: 2.0.2alpha <br> (January 1st 2014)</i>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Connectome Mapper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="download.html"
                        title="next chapter">Download Instruction</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/installation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation-instruction">
<h1>Installation Instruction<a class="headerlink" href="#installation-instruction" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This software is for research purposes only and shall not be used for
any clinical use. This software has not been reviewed or approved by
the Food and Drug Administration or equivalent authority, and is for
non-clinical, IRB-approved Research Use Only. In no event shall data
or images generated through the use of the Software be used in the
provision of patient care.</p>
</div>
<div class="section" id="step-by-step-guide-for-installation-on-ubuntu-debian">
<h2>Step-by-Step Guide for Installation on Ubuntu/Debian<a class="headerlink" href="#step-by-step-guide-for-installation-on-ubuntu-debian" title="Permalink to this headline">¶</a></h2>
<p>Installation of the new Connectome Mapper through <a class="reference internal" href="#debian-install"><em>Debian package installation (Ubuntu &gt;=11.10)</em></a>. For older versions of Ubuntu / different distributions, please look at the <a class="reference internal" href="#manual-install"><em>Manual installation (all distributions)</em></a>.</p>
<p>The steps to add the NeuroDebian repository are explained here:</p>
<div class="highlight-python"><pre>firefox http://neuro.debian.net/</pre>
</div>
<p>Prerequesites are needed anyway, for all the installation choices.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Installed version of Diffusion Toolkit:</p>
<div class="highlight-python"><pre>firefox http://trackvis.org/dtk/</pre>
</div>
</li>
</ul>
<p>Diffusion toolkit executables (&#8216;dtk&#8217;, &#8216;odf_recon&#8217;, ...) should be in the <cite>$PATH</cite>, and <cite>$DSI_PATH</cite> needs to be set to the folder containing the diffusion matrices.</p>
<ul>
<li><p class="first">Installed and configured version of Freesurfer (<a class="reference external" href="http://surfer.nmr.mgh.harvard.edu/">http://surfer.nmr.mgh.harvard.edu/</a>):</p>
<div class="highlight-python"><pre>firefox http://surfer.nmr.mgh.harvard.edu/fswiki/DownloadAndInstall</pre>
</div>
</li>
</ul>
<p><cite>$FREESURFER_HOME</cite> should have been declared and the Freesurfer setup script should have been sourced as described here: <a class="reference external" href="http://surfer.nmr.mgh.harvard.edu/fswiki/SetupConfiguration">http://surfer.nmr.mgh.harvard.edu/fswiki/SetupConfiguration</a>.</p>
<ul>
<li><p class="first">Installed and configured version of FSL (<a class="reference external" href="http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/">http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/</a>). Installation can be done through the NeuroDebian repository:</p>
<div class="highlight-python"><pre>sudo apt-get install fsl fslview fslview-doc</pre>
</div>
</li>
</ul>
<p><cite>$FSLDIR</cite> should have been declared and the FSL setup script should have been sourced as described under &#8220;Installation&#8221; here: <a class="reference external" href="http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSL%20FAQ">http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSL%20FAQ</a></p>
<ul>
<li><p class="first">At this point, make sure that you have setup the environment variables correctly for the external packages such as Freesurfer and Diffusion Toolkit (The FSL environment variables should be set automatically when installing FSL as described above). You should have the environment variables: FREESURFER_HOME, DTDIR, DSI_DIR and FSLDIR. You can check this if you enter in the bash shell (terminal), they should give you the correct path to your packages:</p>
<div class="highlight-python"><pre>echo $FREESURFER_HOME
echo $FSLDIR
echo $DTDIR</pre>
</div>
</li>
</ul>
<p>In case, you can update your bash configuration:</p>
<div class="highlight-python"><pre>gedit /home/username/.bashrc</pre>
</div>
<p>It should contain something similar as (adapted to your installation paths):</p>
<div class="highlight-python"><pre># FREESURFER configuration
export FREESURFER_HOME="/usr/share/freesurfer"
source "${FREESURFER_HOME}/SetUpFreeSurfer.sh"

# DIFFUSION TOOLKIT configuration
export DTDIR="/usr/share/dtk"
export DSI_PATH="/usr/share/dtk/matrices"
export PATH="${DTDIR}:${PATH}"

# FSL configuration
source /etc/fsl/4.1/fsl.sh</pre>
</div>
</div>
<div class="section" id="debian-package-installation-ubuntu-11-10">
<span id="debian-install"></span><h3>Debian package installation (Ubuntu &gt;=11.10)<a class="headerlink" href="#debian-package-installation-ubuntu-11-10" title="Permalink to this headline">¶</a></h3>
<p>Installation is composed of a debian package file (cmp_2.x.x_all.deb, containing the python cmp and cmtklib packages) and compiled binaries (32/64 bit versions available).</p>
<ul class="simple">
<li>Install the .deb package with the Ubuntu Software Center (default if you double click on the package on Ubuntu) or using the dpkg command (sudo dpkg -i cmp_2.x.x_all.deb). This will install all the needed dependencies.</li>
<li>Install the compiled binaries needed by the Connectome Mapper by putting them somewhere in the PATH (e.g. copy all the files of the archive to /usr/local/bin)</li>
<li>Install our forked version of Nipype (<a class="reference external" href="http://nipy.sourceforge.net/nipype/">http://nipy.sourceforge.net/nipype/</a>). For now, we require a modified vesion Nipype interfaces that is available on our Github repository (<a class="reference external" href="https://github.com/LTS5/nipype">https://github.com/LTS5/nipype</a>). To install it clone to your machine the nipype fork by typing <cite>git clone git://github.com/LTS5/nipype.git</cite>, and run the install script with <cite>sudo python setup.py install</cite>. You will have to remove already installed versions of nipype if they were installed through apt-get (installation location: <cite>/usr/lib/pyshared</cite>) as it will take precedence over versions installed through the setup.py script.</li>
</ul>
</div>
<div class="section" id="manual-installation-all-distributions">
<span id="manual-install"></span><h3>Manual installation (all distributions)<a class="headerlink" href="#manual-installation-all-distributions" title="Permalink to this headline">¶</a></h3>
<p>Manual installation is divided between the Python libraries needed by the Connectome Mapper and the CMTKlib and the libraries needed by the DTB binaries. Files for manual installation is the zipped archive of the Connectome Mapper.
* As we will use <cite>easy_install</cite> in order to have access to the latest libraries even on older systems the python-setuptools package is needed. Ipython is strongly recommended for debugging purposes. Debian/Ubuntu command: <cite>sudo apt-get install python-setuptools ipython</cite>
* Python libraries needed: traits, traitsui, pyface, nibabel, numpy, networkx, scipy. Easy_install command: <cite>sudo easy_install traits traitsui pyface nibabel numpy networkx scipy nose</cite>
* Install our forked version of Nipype (<a class="reference external" href="http://nipy.sourceforge.net/nipype/">http://nipy.sourceforge.net/nipype/</a>). For now, we require a modified vesion Nipype interfaces that is available on our Github repository (<a class="reference external" href="https://github.com/LTS5/nipype">https://github.com/LTS5/nipype</a>). To install it clone to your machine the nipype fork by typing <cite>git clone git://github.com/LTS5/nipype.git</cite>, and run the install script with <cite>sudo python setup.py install</cite>. You will have to remove already installed versions of nipype if they were installed through apt-get (installation location: <cite>/usr/lib/pyshared</cite>) as it will take precedence over versions installed through the setup.py script.
* Libraries needed by the DTB binaries: boost (module program-options), nifti, blitz. Debian/Ubuntu</p>
<p>Now, you are ready to start the Connectome Mapper from the Bash Shell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">connectomemapper</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sample-dataset">
<h2>Sample dataset<a class="headerlink" href="#sample-dataset" title="Permalink to this headline">¶</a></h2>
<p>To get you started, we provide two Diffusion Spectrum Imaging sample datasets. They already contain the correct
folder structure described below. You can find the two <a class="reference external" href="http://cmtk.org/datasets/rawdata/">raw datasets online</a>:</p>
<dl class="docutils">
<dt>project01_dsi</dt>
<dd><em>connectome_0001</em> with timepoint <em>tp1</em> and DSI, T1 and T2 raw data</dd>
<dt>project02_dsi</dt>
<dd><em>connectome_0002</em> with timepoint <em>tp1</em> and DSI, T1 raw data</dd>
</dl>
<p>If you produce any connectome dataset that you want to share with the community, we provide a curated
<a class="reference external" href="http://github.com/LTS5/cffdata">cffdata repository on GitHub</a> .</p>
</div>
<div class="section" id="project-configuration-and-setup">
<h2>Project configuration and setup<a class="headerlink" href="#project-configuration-and-setup" title="Permalink to this headline">¶</a></h2>
<p>Steps to do before executing the pipeline</p>
<p>#. Create the folder structure for your project for DSI data. For DTI data, rename the folder DSI to DTI. For QBALL data, rename the folder DSI to QBALL.
If you have resting state fMRI data, create a new folder &#8216;fMRI&#8217; in RAWDATA.:</p>
<div class="highlight-python"><pre>├── myproject
│   ├── control001
│   │   └── tp1
│   │       ├── RAWDATA
│   │       │   ├── DSI
│   │       │   ├── T1
│   │       │   ├── T2
│   │       │   └── fMRI</pre>
</div>
<ol class="arabic">
<li><p class="first">Copy the Diffusion / MPRAGE (DSI, DTI, QBALL, T1, T2, fMRI) images (DICOM series) in the corresponding folders.
The T2 images are optional but they improve the registration of the data. The fMRI images are optional.</p>
</li>
<li><p class="first">Run the Connectome Mapper and configure it for your project:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">connectomemapper</span>
</pre></div>
</div>
</li>
<li><p class="first">After the first run of the e.g. the first module DICOM Converter, the folder structure should look like this:</p>
<div class="highlight-python"><pre>├── myproject
│   ├── control001
│   │   └── tp1
│   │       ├── CMP
│   │       │   ├── cff
│   │       │   ├── fibers
│   │       │   ├── fMRI
│   │       │   ├── fs_output
│   │       │   ├── raw_diffusion
│   │       │   └── scalars
│   │       ├── FREESURFER
│   │       │   └── mri
│   │       ├── LOG
│   │       ├── NIFTI
│   │       │   ├── diffusion_metadata
│   │       │   ├── transformations
│   │       │   └── wm_correction
│   │       ├── RAWDATA
│   │       │   ├── DSI
│   │       │   ├── T1
│   │       │   ├── T2
│   │       │   └── fMRI
│   │       └── STATS</pre>
</div>
</li>
</ol>
<p>All the files for your subject will be stored in this folder structure.</p>
<p>In the GUI, now you should setup all the parameters for your your single subject and hit the <em>Map connectome!</em> button.
You select the stages you want to run. To produce a connectome, all the stages have to be run in sequential order.</p>
<p>If you have to restart the GUI later and do not want to enter everything again, you can open the LOG folder,
there are so-called pickle files with ending .pkl and you can load them with the <em>Load</em> button in the GUI to restore your configuration state.</p>
<p>Alternatively, you can also open a pickle file directly from the Bash shell when starting the Connectome Mapper:</p>
<div class="highlight-python"><pre>connectomemapper mypickle.pkl</pre>
</div>
<p>If you run into any problems or have any questions, post to the <a class="reference external" href="http://groups.google.com/group/cmtk-users">CMTK-users group</a>.</p>
</div>
<div class="section" id="starting-the-pipeline-without-gui">
<h2>Starting the pipeline without GUI<a class="headerlink" href="#starting-the-pipeline-without-gui" title="Permalink to this headline">¶</a></h2>
<p>You can start the pipeline also from IPython or in a script. You can find an map_connectome.py example file
in the source code repository in /example/default_project/map_connectome.py.</p>
<p>You can start to modify this script to loop over subjects and/or load the &#8220;pickle&#8221; file automatically, add:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cmp.gui</span> <span class="kn">import</span> <span class="n">CMPGUI</span>
<span class="n">cmpgui</span> <span class="o">=</span> <span class="n">CMPGUI</span><span class="p">()</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">load_state</span><span class="p">(</span><span class="s">&#39;/path/to/your/pickle/state/LOG/cmp.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can set the attributes of the cmpgui configuration object in the script and directly call the pipeline execution engine:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cmpgui</span><span class="o">.</span><span class="n">active_dicomconverter</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">project_dir</span> <span class="o">=</span> <span class="s">&#39;.../&#39;</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">subject_name</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">subject_timepoint</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
<span class="n">cmpgui</span><span class="o">.</span><span class="n">subject_workingdir</span> <span class="o">=</span> <span class="s">&#39;.../&#39;</span>
<span class="nb">cmp</span><span class="o">.</span><span class="n">connectome</span><span class="o">.</span><span class="n">mapit</span><span class="p">(</span><span class="n">cmpgui</span><span class="p">)</span>
</pre></div>
</div>
<p>For a full list of field names, refer to the <a class="reference external" href="http://github.com/LTS5/cmp/blob/master/cmp/configuration.py">source code</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="download.html" title="Download Instruction"
             >next</a></li>
        <li class="right" >
          <a href="index.html" title="Connectome Mapper"
             >previous</a> |</li>
        <li><a href="index.html">The Connectome Mapper</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, EPFL &amp; UNIL-CHUV.
      Last updated on Dec 24, 2013.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>